import { useState } from "react";
import { View, Image, StyleSheet, Text, TouchableOpacity } from "react-native";
import Svg, { Path, G } from "react-native-svg";

export default function BodyMap({ value, onValueChange }) {
  const [selectedSection, setSelectedSection] = useState(value || null);

  // Handle section selection
  const handleSectionPress = (section) => {
    console.log("Section pressed:", section.label);
    setSelectedSection(section.label);
    if (onValueChange) {
      onValueChange(section.label);
    }
  };

  // Body sections mapping coordinates
  const bodySections = [
    {
      id: "head",
      label: "Head",
      coordinates:
        "M219.534 124.12H155.034C149.652 115.6 145.651 110.781 142.034 103.12C123.693 64.2671 129.534 24.6198 156.034 8.6198C177.512 -0.699488 190.709 -1.76291 208.387 4.23049C215.917 6.78306 222.895 10.9374 228.361 16.7105C254.309 44.1166 248.419 78.1773 219.534 124.12Z"
    },
    {
      id: "neck",
      label: "Neck",
      coordinates:
        "M155.034 124.62C143.034 136.12 134.433 139.377 116.034 146.12L151.034 154.12L155.034 150.62L159.034 149.62L164.034 148.62L168.534 148.12H207.534L214.034 149.12L219.534 150.12L225.534 154.12L259.034 147.62C239.535 140.093 230.335 135.171 219.534 124.12"
    },
    {
      id: "r_shoulder",
      label: "Right Shoulder",
      coordinates:
        "M136.034 178.12L150.534 154.12L116.534 146.12L101.034 151.12L92.5342 154.12L85.5342 157.12L82.0342 159.62L78.5342 162.12L75.0342 165.12L73.0342 170.12L71.5342 174.62L70.0342 180.12V200.12L109.534 192.62L121.034 188.62L128.034 185.62L133.034 182.12L136.034 178.12Z"
    },
    {
      id: "l_shoulder",
      label: "Left Shoulder",
      coordinates:
        "M239.534 181.12L226.034 154.12L259.034 147.62L274.534 151.12L283.034 154.12L290.034 157.12L294.034 160.12L297.034 162.62L300.534 165.62L302.534 170.62L304.034 175.12V180.12L305.034 203.12L265.534 195.62L254.534 191.62L247.534 188.62L242.534 185.12L239.534 181.12Z"
    },
    {
      id: "r_arm_upper",
      label: "Right Upper Arm",
      coordinates:
        "M68.5342 245.12L70.0175 200.62L96.0342 195.62L121.518 188.62L121.534 204.62L119.534 223.12L113.534 265.12L111.034 275.62L109.534 295.12L106.034 313.12L65.5342 304.62L67.0342 291.12L68.5342 267.62V245.12Z"
    },
    {
      id: "l_arm_upper",
      label: "Left Upper Arm",
      coordinates:
        "M305.551 247.62V203.12L279.534 198.12L254.051 191.12L255.034 207.62L258.034 225.62L264.534 269.12L266.034 278.12L268.034 298.12L272.034 318.62L310.034 311.62L307.034 294.12L305.551 270.12V247.62Z"
    },
    {
      id: "r_arm_lower",
      label: "Right Lower Arm",
      coordinates:
        "M105.534 313.62L65.5342 305.12L64.0342 310.62L62.0342 318.12L58.5342 325.62L56.0342 334.12L54.5342 343.62L52.5342 355.12L51.5342 388.62L50.0342 401.62L48.5342 416.12L45.0342 428.62L43.0342 440.12L39.5342 449.62L73.5342 458.62L76.0342 445.62L78.5342 435.12L84.5342 416.12L93.5342 385.12L99.5342 367.62L103.534 354.62L105.534 338.62V313.62Z"
    },
    {
      id: "l_arm_lower",
      label: "Left Lower Arm",
      coordinates:
        "M272.034 318.62L310.534 312.12L313.534 318.62L315.534 323.12L317.034 330.12L319.534 338.62L321.034 348.12L322.034 359.62L324.034 394.62L325.034 407.12L327.534 421.12L331.034 433.62L333.034 445.12L335.534 450.62L305.034 466.62L303.034 450.62L300.034 439.62L294.534 421.12L285.534 390.12L279.534 372.62L275.534 359.62L272.034 343.62V318.62Z"
    },
    {
      id: "r_hand",
      label: "Right Hand",
      coordinates:
        "M34.5342 457.62L39.0342 449.62L73.0342 458.62V471.12L71.5342 477.62L70.0342 483.62L68.5342 489.62L67.5342 496.62V513.62V517.62L66.5342 521.12L66.0342 523.12L64.5342 523.62H62.5342L60.5342 522.12L59.5342 520.62L59.0342 517.62L58.5342 514.12V509.12L58.0342 505.62L57.5342 503.62L56.0342 502.62L54.5342 503.62L53.5342 508.62V512.62L52.5342 516.62L52.0342 521.12L51.0342 525.62L50.0342 529.62L49.5342 533.62L48.0342 535.62L45.5342 536.62L42.5342 535.62L41.0342 533.12L41.5342 526.62L42.5342 520.12L43.0342 513.12V506.62L39.5342 516.12L38.5342 519.62L38.0342 522.12L37.5342 524.62L36.5342 526.62L36.0342 529.12L35.5342 531.62L35.0342 533.62L33.5342 535.62L32.5342 536.62H30.5342L29.0342 535.62L28.0342 534.62L27.0342 532.12V528.62L27.5342 525.12V522.12L28.0342 519.12L29.0342 516.12L29.5342 513.12L30.0342 509.62L30.5342 505.12V502.62L25.0342 526.12L24.0342 527.62L22.5342 529.62L21.0342 530.12L19.5342 529.62L18.0342 526.62V517.12V511.12L19.5342 505.62L21.0342 499.12L23.0342 493.12L24.0342 487.62V482.62V479.12L21.0342 480.12L18.0342 483.62L15.0342 488.62L12.5342 493.12L9.03418 495.62L6.53418 496.62L3.53418 497.62L1.53418 496.62L0.53418 494.62L1.53418 491.12L5.03418 486.62L9.03418 481.12L11.5342 476.62L14.0342 471.12L16.0342 466.12L21.0342 462.62L29.5342 457.62L34.5342 454.62Z"
    },
    {
      id: "l_hand",
      label: "Left Hand",
      coordinates:
        "M342.034 455.62L335.534 450.62L305.034 466.62L305.534 471.62L306.534 478.12L307.034 484.12L308.534 490.12L310.534 497.12V514.12V518.12L311.534 523.62L312.034 525.62L313.534 526.12H315.534L317.534 524.62L318.034 522.12L318.534 518.62L319.034 514.12L319.534 510.12V508.12L320.034 506.12L321.534 505.12L323.034 506.12L324.034 511.12V515.12V519.12L324.534 523.12L325.534 527.62L326.534 531.62L327.034 535.62L328.534 537.62L331.034 538.62L334.034 537.62L335.534 535.12L335.034 528.62L334.034 522.12L333.534 515.12L333.034 505.62L336.034 514.12L338.034 521.62L338.534 524.12L339.034 526.62L340.034 528.62L340.534 531.12L341.034 533.62L341.534 535.62L343.034 537.62L344.034 538.62H346.034L347.534 537.62L348.534 536.62L349.534 534.12V530.62L349.034 527.12V524.12L348.534 521.12L347.534 518.12L347.034 515.12L346.534 511.62L346.034 507.12V504.62L351.534 528.12L352.534 529.62L354.034 531.62L355.534 532.12L357.034 531.62L358.534 528.62V519.12V513.12L357.034 507.62L355.534 501.12L354.034 493.62L353.034 488.12L352.534 483.62L352.034 480.62L355.034 481.62L358.034 485.12L361.034 490.12L363.534 494.62L367.034 497.12L369.534 498.12L372.534 499.12L374.534 498.12L375.534 496.12L374.534 492.62L371.034 488.12L367.034 482.62L364.534 478.12L362.034 472.62L359.534 467.62L355.534 463.62L347.034 458.62L342.034 455.62Z"
    },
    {
      id: "r_chest",
      label: "Right-Side Chest",
      coordinates:
        "M156.534 150.62L167.034 148.62H186.534L188.034 300.62H117.034V293.12V289.12V285.62L115.534 276.12L114.534 267.12V260.62L115.534 253.62L117.034 242.62L118.034 236.12L119.034 228.62L121.034 213.62L122.034 204.62V188.62L127.534 186.12L133.534 181.62L143.534 166.12L151.034 155.12L156.534 150.62Z"
    },
    {
      id: "l_chest",
      label: "Left-Side Chest",
      coordinates:
        "M217.534 150.12L207.034 148.12H187.534L188.034 300.12H260.534V292.62V288.62V285.12L262.034 277.12L263.034 266.62V260.12L262.034 253.12L260.534 242.12L259.534 235.62L258.534 228.12L256.034 212.62L255.034 204.12L253.534 191.62L245.534 188.12L239.534 182.12L231.034 163.12L225.534 154.12L217.534 150.12Z"
    },
    {
      id: "r_abdomen",
      label: "Right-Side Abdomen",
      coordinates:
        "M104.534 449.62L188.034 450.62V301.12H117.534V377.12L116.034 387.62L110.034 417.12L104.534 449.62Z"
    },
    {
      id: "l_abdomen",
      label: "Left-Side Abdomen",
      coordinates:
        "M273.034 450.62H189.034V301.12H260.534V377.62L261.534 387.62L267.034 417.12L273.034 450.62Z"
    },
    {
      id: "r_hip",
      label: "Right Hip",
      coordinates:
        "M163.534 450.12H104.034L99.0342 478.12V496.12L101.034 516.62V545.62L137.534 527.62L163.534 450.12Z"
    },
    {
      id: "l_hip",
      label: "Left Hip",
      coordinates:
        "M214.034 450.12H273.534L277.534 478.12L278.534 496.12L277.534 517.12L276.534 551.12L232.534 528.62L214.034 450.12Z"
    },
    {
      id: "groin",
      label: "Groin",
      coordinates:
        "M185.034 504.12L137.534 527.62L163.534 451.12H214.534L232.534 528.62L185.034 504.12Z"
    },
    {
      id: "r_leg_upper",
      label: "Right Upper Leg",
      coordinates:
        "M101.034 545.62L182.534 505.12V515.12V527.62L180.534 548.12L177.534 570.12L175.534 592.12L172.034 617.12L170.034 637.62L166.034 671.62L101.034 670.12V545.62Z"
    },
    {
      id: "l_leg_upper",
      label: "Left Upper Leg",
      coordinates:
        "M276.534 550.62L188.034 505.12V520.12L189.034 532.12L191.034 552.62L194.034 574.62L196.034 596.62L199.534 621.62L201.534 642.12L205.534 670.62H273.534L276.534 611.12V550.62Z"
    },
    {
      id: "r_knee",
      label: "Right Knee",
      coordinates:
        "M166.034 671.12L101.034 670.12V687.62L103.034 699.12V725.62H164.534V704.12L163.534 691.62L166.034 671.12Z"
    },
    {
      id: "l_knee",
      label: "Left Knee",
      coordinates:
        "M205.534 671.12H273.034L271.034 686.62L268.034 700.12L268.534 725.12H214.034L212.534 705.12L209.034 692.62L205.534 671.12Z"
    },
    {
      id: "r_leg_lower",
      label: "Right Lower Leg",
      coordinates:
        "M103.034 744.12V725.62H165.034V744.12L163.534 758.62L162.534 769.12L160.034 780.62L157.034 795.62L153.534 816.12L149.534 851.62H119.034L115.034 823.62L113.034 809.12L111.534 795.62L108.534 777.12L104.534 759.12L103.034 744.12Z"
    },
    {
      id: "l_leg_lower",
      label: "Left Lower Leg",
      coordinates:
        "M268.534 743.12V725.12H213.534L211.534 745.12V758.62V768.62L212.534 780.12L215.034 795.12L216.034 816.12L218.034 853.62H252.034L257.534 824.12L260.534 809.62L263.034 796.62L265.534 776.62L267.534 758.62L268.534 743.12Z"
    },
    {
      id: "r_foot",
      label: "Right Foot",
      coordinates:
        "M120.534 867.12L119.034 851.62H149.534L156.034 871.12V882.62L149.534 893.12L145.534 909.12L141.534 922.12L139.034 933.12L135.034 944.12L131.034 950.62H111.534H104.034L99.5342 947.62L98.5342 942.62V935.12L99.5342 926.62L102.034 918.12L106.034 910.12L111.534 899.62L116.034 889.12L119.034 878.62L120.534 867.12Z"
    },
    {
      id: "l_foot",
      label: "Left Foot",
      coordinates:
        "M252.034 869.62V854.12H218.034L213.534 873.62V880.12L216.534 885.12L221.534 890.12L223.034 895.62L227.034 911.12L230.534 924.62L233.034 935.12L236.034 946.62L241.034 952.62L259.034 955.62H270.034L274.534 952.62L275.534 947.62V937.12L273.534 929.12L270.034 921.12L266.034 912.62L262.034 901.12L257.534 890.62L254.534 880.12L252.034 869.62Z"
    }
  ];

  return (
    <View style={styles.container}>
      {/* Background body map image */}
      <View style={styles.imageContainer}>
        <Image
          source={require("../../assets/BodyMapFront.png")}
          style={styles.bodyImage}
          resizeMode="contain"
        />

        {/* SVG overlay for interactive sections */}
        <Svg
          width="100%"
          height="100%"
          viewBox="0 -9 384 980"
          style={styles.svgOverlay}
        >
          {bodySections.map((section) => (
            <G key={section.id}>
              <Path
                d={section.coordinates}
                fill={
                  selectedSection === section.label ? "#1d65ec80" : "#cecece20"
                }
                onPressIn={() => handleSectionPress(section)}
                onPress={() => handleSectionPress(section)}
              />
            </G>
          ))}
        </Svg>
      </View>

      {/* Display selected section label */}
      {selectedSection && (
        <Text style={styles.selectedLabel}>Selected: {selectedSection}</Text>
      )}
    </View>
  );
}

const styles = StyleSheet.create({
  container: {
    alignItems: "center",
    justifyContent: "center",
    width: "100%"
  },
  imageContainer: {
    position: "relative",
    width: 400,
    height: 700,
    alignItems: "center",
    justifyContent: "center"
  },
  bodyImage: {
    width: "100%",
    height: "100%"
  },
  svgOverlay: {
    position: "absolute",
    top: 0,
    left: 0
  },
  selectedLabel: {
    marginTop: 20,
    fontSize: 18,
    fontWeight: "bold",
    fontFamily: "Rubik",
    color: "#1d65ecff"
  }
});
